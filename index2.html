<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Documentation Study Visualization</title>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <style>
        body {
            font: 10px sans-serif;
        }

        .chord path {
            fill-opacity: .67;
            stroke: #000;
            stroke-width: .5px;
        }
    </style>

</head>
<body>

<script>
    d3.json("data/data.json", function(error, data) {

        // From http://mkweb.bcgsc.ca/circos/guide/tables/

        var chord = d3.layout.chord()
                .padding(.05)
                .matrix(data.transitionMatrix);

        var width = 960,
                height = 500,
                innerRadius = Math.min(width, height) * .41,
                outerRadius = innerRadius * 1.1;

        var fill = d3.scale.ordinal()
                .domain(data.categories.map(function(c) {
                    return c.code;
                })).range(data.categories.map(function(c) {
                    return "#" + c.color;
                }));

        var svg = d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

        svg.append("g").selectAll("path")
                .data(chord.groups)
                .enter().append("path")
                .style("fill", function(d) {
                    return fill(d.index);
                })
                .style("stroke", function(d) {
                    return fill(d.index);
                })
                .attr("d", d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius))

        svg.append("g")
                .attr("class", "chord")
                .selectAll("path")
                .data(chord.chords)
                .enter().append("path")
                .attr("d", d3.svg.chord().radius(innerRadius))
                .style("fill", function(d) {
                    return fill(d.target.index);
                })
                .style("opacity", 1);

        // This is copy-paste from index.html
        var legend = svg.append("g")
                .attr("class", "legend-group")
                .attr("transform", "translate(" + (width / 2 - 18) + "," + (-1*height/2 + 32) + ")")
                .selectAll(".legend")
                .data(data.categories).enter()
                .append("g")
                .attr("class", "legend")
                .attr("transform", function(d, i) {
                    return "translate(0," + i * 20 + ")";
                });

        legend.append("rect")
                .attr("x", 0)
                .attr("width", 18)
                .attr("height", 18)
                .style("fill", function(d) {
                    return fill(d.code);
                });

        legend.append("text")
                .attr("x", -10)
                .attr("y", 9)
                .attr("dy", ".35em")
                .style("text-anchor", "end")
                .text(function(d) {
                    return d.label;
                });

    });

</script>

</body>
</html>
